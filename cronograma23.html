<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cronograma Marcenaria</title>
  <style>
    body { font-family: Arial; background: #f2f2f2; margin: 20px; }
    h1 { text-align: center; }
    .form, .filters {
      max-width: 600px; margin: auto; margin-bottom: 20px;
      background: #fff; padding: 20px; border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
    }
    .form input, .form select, .form button {
      width: 100%; padding: 10px; margin: 8px 0; font-size: 1em;
    }
    .filters select {
      width: 100%; padding: 10px; font-size: 1em;
    }
    .calendar {
      display: grid; grid-template-columns: repeat(7, 1fr);
      gap: 10px; max-width: 1200px; margin: auto;
    }
    .day {
      background: #fff; border: 1px solid #ccc;
      padding: 10px; min-height: 180px; border-radius: 6px;
    }
    .day-number { font-weight: bold; margin-bottom: 5px; font-size: 1.2em; }
    .event {
      margin: 5px 0; padding: 5px; font-size: 0.9em;
      border-left: 4px solid; border-radius: 4px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .interno { border-color: #0d6efd; background: #e7f1ff; }
    .montagem { border-color: #198754; background: #d1e7dd; }
    .pedido { border-color: #ffc107; background: #fff3cd; }
    .cliente { border-color: #dc3545; background: #f8d7da; }
    .header {
      text-align: center; font-weight: bold;
      background: #198754; color: white;
      padding: 10px 0; border-radius: 6px;
    }
    .month-nav {
      text-align: center; margin-bottom: 20px;
    }
    .month-nav button {
      padding: 10px 20px; margin: 0 10px; font-size: 1em;
    }
    .event button {
      background: none; border: none; cursor: pointer;
      font-size: 1em; margin-left: 10px;
    }
  </style>
</head>
<body>
  <h1>Cronograma Marcenaria</h1>

  <div class="month-nav">
    <button onclick="mudarMes(-1)">← Mês anterior</button>
    <span id="mesAtual"></span>
    <button onclick="mudarMes(1)">Próximo mês →</button>
  </div>

  <div class="filters">
    <label for="filtroTipo">Filtrar por tipo:</label>
    <select id="filtroTipo" onchange="renderizarEventos()">
      <option value="todos">Todos</option>
      <option value="interno">Produção Interna</option>
      <option value="montagem">Montagem Externa</option>
      <option value="pedido">Pedido de Materiais</option>
      <option value="cliente">Atendimento ao Cliente</option>
    </select>
  </div>

  <div class="form">
    <input type="text" id="descricao" placeholder="Descrição do compromisso">
    <select id="tipo">
      <option value="interno">Produção Interna (dias)</option>
      <option value="montagem">Montagem Externa (dias)</option>
      <option value="pedido">Pedido de Materiais (1 dia)</option>
      <option value="cliente">Atendimento ao Cliente (horas)</option>
    </select>
    <input type="number" id="duracao" placeholder="Duração (dias ou horas)">
    <input type="date" id="dataInicio">
    <button onclick="adicionarEvento()">Adicionar</button>
  </div>

  <div class="calendar" id="calendario"></div>

  <script>
    let dataReferencia = new Date();
    let eventoEditando = null;

    function formatarData(data) {
      return data.toISOString().split("T")[0];
    }

    function atualizarMes() {
      const mes = dataReferencia.toLocaleString("pt-BR", { month: "long", year: "numeric" });
      document.getElementById("mesAtual").textContent = mes.charAt(0).toUpperCase() + mes.slice(1);
      gerarCalendario();
      renderizarEventos();
    }

    function mudarMes(delta) {
      dataReferencia.setMonth(dataReferencia.getMonth() + delta);
      atualizarMes();
    }

    function gerarCalendario() {
      const calendario = document.getElementById("calendario");
      calendario.innerHTML = "";

      const ano = dataReferencia.getFullYear();
      const mes = dataReferencia.getMonth();
      const diasNoMes = new Date(ano, mes + 1, 0).getDate();

      for (let i = 1; i <= diasNoMes; i++) {
        const dia = document.createElement("div");
        dia.className = "day";
        const data = new Date(ano, mes, i);
        dia.id = formatarData(data);
        dia.innerHTML = `<div class="day-number">${i}</div>`;
        calendario.appendChild(dia);
      }
    }

    function adicionarEvento() {
      const descricao = document.getElementById("descricao").value;
      const tipo = document.getElementById("tipo").value;
      const duracao = parseInt(document.getElementById("duracao").value);
      const dataInicio = new Date(document.getElementById("dataInicio").value);

      if (!descricao || !tipo || isNaN(duracao) || isNaN(dataInicio)) {
        alert("Preencha todos os campos corretamente!");
        return;
      }

      let eventos = JSON.parse(localStorage.getItem("eventos")) || [];

      if (eventoEditando !== null) {
        eventos.splice(eventoEditando, 1);
        eventoEditando = null;
        document.querySelector(".form button").textContent = "Adicionar";
      }

      if (tipo === "interno" || tipo === "montagem") {
        for (let i = 0; i < duracao; i++) {
          const data = new Date(dataInicio);
          data.setDate(data.getDate() + i);
          eventos.push({ descricao, tipo, data: formatarData(data), duracao: 1 });
        }
      } else {
        eventos.push({ descricao, tipo, data: formatarData(dataInicio), duracao });
      }

      localStorage.setItem("eventos", JSON.stringify(eventos));
      limparFormulario();
      renderizarEventos();
    }

    function limparFormulario() {
      document.getElementById("descricao").value = "";
      document.getElementById("tipo").value = "interno";
      document.getElementById("duracao").value = "";
      document.getElementById("dataInicio").value = "";
    }

    function editarEvento(index) {
      const eventos = JSON.parse(localStorage.getItem("eventos")) || [];
      const evento = eventos[index];
      eventoEditando = index;

      document.getElementById("descricao").value = evento.descricao;
      document.getElementById("tipo").value = evento.tipo;
      document.getElementById("duracao").value = evento.duracao;
      document.getElementById("dataInicio").value = evento.data;
      document.querySelector(".form button").textContent = "Atualizar";
    }

    function renderizarEventos() {
      const eventos = JSON.parse(localStorage.getItem("eventos")) || [];
      const ano = dataReferencia.getFullYear();
      const mes = dataReferencia.getMonth();
      const filtro = document.getElementById("filtroTipo").value;

      document.querySelectorAll(".day").forEach(d => {
        const num = d.querySelector(".day-number").textContent;
        d.innerHTML = `<div class="day-number">${num}</div>`;
      });

      eventos.forEach((e, index) => {
        const data = new Date(e.data);
        if (data.getFullYear() === ano && data.getMonth() === mes) {
          if (filtro === "todos" || filtro === e.tipo) {
            const container = document.getElementById(e.data);
            if (container) {
                const div = document.createElement("div");
            div.className = `event ${e.tipo}`;
            div.innerHTML = `
              ${e.descricao} (${e.duracao}${e.tipo === "cliente" ? "h" : "d"})
              <button onclick="editarEvento(${index})">✏️</button>
            `;
            container.appendChild(div);
          }
        }
      }
    });
  }

  // Inicializa o calendário ao carregar
  atualizarMes();
</script>